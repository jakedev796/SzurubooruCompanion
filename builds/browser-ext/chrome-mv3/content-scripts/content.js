var content=(function(){"use strict";var ot=Object.defineProperty;var ct=(M,C,L)=>C in M?ot(M,C,{enumerable:!0,configurable:!0,writable:!0,value:L}):M[C]=L;var q=(M,C,L)=>ct(M,typeof C!="symbol"?C+"":C,L);function M(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C={exports:{}},L=C.exports,Y;function ne(){return Y||(Y=1,(function(e,t){(function(s,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:L,function(s){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)s.exports=globalThis.browser;else{const r="The message port closed before a response was received.",n=a=>{const i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(i).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(u,f=void 0){super(f),this.createItem=u}get(u){return this.has(u)||this.set(u,this.createItem(u)),super.get(u)}}const c=l=>l&&typeof l=="object"&&typeof l.then=="function",g=(l,u)=>(...f)=>{a.runtime.lastError?l.reject(new Error(a.runtime.lastError.message)):u.singleCallbackArg||f.length<=1&&u.singleCallbackArg!==!1?l.resolve(f[0]):l.resolve(f)},m=l=>l==1?"argument":"arguments",A=(l,u)=>function(h,...w){if(w.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${m(u.minArgs)} for ${l}(), got ${w.length}`);if(w.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${m(u.maxArgs)} for ${l}(), got ${w.length}`);return new Promise((S,k)=>{if(u.fallbackToNoCallback)try{h[l](...w,g({resolve:S,reject:k},u))}catch(d){console.warn(`${l} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,d),h[l](...w),u.fallbackToNoCallback=!1,u.noCallback=!0,S()}else u.noCallback?(h[l](...w),S()):h[l](...w,g({resolve:S,reject:k},u))})},b=(l,u,f)=>new Proxy(u,{apply(h,w,S){return f.call(w,l,...S)}});let x=Function.call.bind(Object.prototype.hasOwnProperty);const T=(l,u={},f={})=>{let h=Object.create(null),w={has(k,d){return d in l||d in h},get(k,d,E){if(d in h)return h[d];if(!(d in l))return;let y=l[d];if(typeof y=="function")if(typeof u[d]=="function")y=b(l,l[d],u[d]);else if(x(f,d)){let U=A(d,f[d]);y=b(l,l[d],U)}else y=y.bind(l);else if(typeof y=="object"&&y!==null&&(x(u,d)||x(f,d)))y=T(y,u[d],f[d]);else if(x(f,"*"))y=T(y,u[d],f["*"]);else return Object.defineProperty(h,d,{configurable:!0,enumerable:!0,get(){return l[d]},set(U){l[d]=U}}),y;return h[d]=y,y},set(k,d,E,y){return d in h?h[d]=E:l[d]=E,!0},defineProperty(k,d,E){return Reflect.defineProperty(h,d,E)},deleteProperty(k,d){return Reflect.deleteProperty(h,d)}},S=Object.create(l);return new Proxy(S,w)},K=l=>({addListener(u,f,...h){u.addListener(l.get(f),...h)},hasListener(u,f){return u.hasListener(l.get(f))},removeListener(u,f){u.removeListener(l.get(f))}}),nt=new o(l=>typeof l!="function"?l:function(f){const h=T(f,{},{getContent:{minArgs:0,maxArgs:0}});l(h)}),re=new o(l=>typeof l!="function"?l:function(f,h,w){let S=!1,k,d=new Promise(R=>{k=function(I){S=!0,R(I)}}),E;try{E=l(f,h,k)}catch(R){E=Promise.reject(R)}const y=E!==!0&&c(E);if(E!==!0&&!y&&!S)return!1;const U=R=>{R.then(I=>{w(I)},I=>{let Z;I&&(I instanceof Error||typeof I.message=="string")?Z=I.message:Z="An unexpected error occurred",w({__mozWebExtensionPolyfillReject__:!0,message:Z})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return U(y?E:d),!0}),at=({reject:l,resolve:u},f)=>{a.runtime.lastError?a.runtime.lastError.message===r?u():l(new Error(a.runtime.lastError.message)):f&&f.__mozWebExtensionPolyfillReject__?l(new Error(f.message)):u(f)},se=(l,u,f,...h)=>{if(h.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${m(u.minArgs)} for ${l}(), got ${h.length}`);if(h.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${m(u.maxArgs)} for ${l}(), got ${h.length}`);return new Promise((w,S)=>{const k=at.bind(null,{resolve:w,reject:S});h.push(k),f.sendMessage(...h)})},it={devtools:{network:{onRequestFinished:K(nt)}},runtime:{onMessage:K(re),onMessageExternal:K(re),sendMessage:se.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:se.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},W={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":W},services:{"*":W},websites:{"*":W}},T(a,it,i)};s.exports=n(chrome)}})})(C)),C.exports}var ae=ne();const _=M(ae);function ut(e){return e}function N(e){try{const r=new URL(e).pathname.split("/").filter(Boolean);if(r.length>0){const a=r[r.length-1].split("?")[0].split("#")[0];if(a&&a.length>0)return a}}catch{}return`media_${Date.now()}`}function v(e){return e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^\w\-_:]/g,"").slice(0,64)}function J(e){const t=[],s=e.matchAll(/#(\w+)/g);for(const r of s){const n=v(r[1]);n.length>=2&&t.push(n)}return[...new Set(t)]}function ie(e){var t;if(e.tagName==="IMG")return e.src;if(e.tagName==="VIDEO"){const s=e;return s.currentSrc||s.poster||((t=s.querySelector("source"))==null?void 0:t.src)||null}return null}function O(e,t){if(e.tagName==="VIDEO")return!0;const s=[".mp4",".webm",".mov",".gifv"],r=t.toLowerCase();return s.some(n=>r.includes(n))||t.startsWith("blob:")}const B="szuru-companion-grab-btn",oe=200,ce=100,p={currentMedia:null,hoverTimeout:null,isButtonHovered:!1};function le(){return`
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="17 8 12 3 7 8"/>
      <line x1="12" y1="3" x2="12" y2="15"/>
    </svg>
  `}function Q(){let e=document.getElementById(B);return e||(e=document.createElement("button"),e.id=B,e.innerHTML=le(),e.title="Send to Szurubooru",e.type="button",Object.assign(e.style,{position:"fixed",width:"32px",height:"32px",borderRadius:"50%",background:"#6366f1",color:"white",border:"2px solid white",cursor:"pointer",zIndex:"2147483647",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",display:"none",alignItems:"center",justifyContent:"center",transition:"transform 0.15s ease, opacity 0.15s ease, background 0.15s ease",opacity:"0",pointerEvents:"auto",padding:"0",margin:"0",boxSizing:"border-box"}),e.addEventListener("mouseenter",()=>{e.style.background="#4f46e5",e.style.transform="scale(1.1)",p.isButtonHovered=!0,p.hoverTimeout&&(clearTimeout(p.hoverTimeout),p.hoverTimeout=null)}),e.addEventListener("mouseleave",()=>{e.style.background="#6366f1",e.style.transform="scale(1)",p.isButtonHovered=!1,ee()}),e.addEventListener("mousedown",()=>{e.style.transform="scale(0.95)"}),e.addEventListener("mouseup",()=>{e.style.transform="scale(1.1)"}),document.body.appendChild(e)),e}function X(e,t){const s=t.getBoundingClientRect(),r=Math.max(8,s.top+8),n=Math.max(8,s.left+8),a=window.innerWidth-40,i=window.innerHeight-40;e.style.top=`${Math.min(r,i)}px`,e.style.left=`${Math.min(n,a)}px`,e.style.display="flex",e.offsetHeight,e.style.opacity="1"}function ee(){p.hoverTimeout&&clearTimeout(p.hoverTimeout),p.hoverTimeout=setTimeout(()=>{p.isButtonHovered||ue()},ce)}function ue(){const e=document.getElementById(B);e&&(e.style.opacity="0",setTimeout(()=>{e.style.opacity==="0"&&(e.style.display="none")},150)),p.currentMedia=null}function ge(e){const t=Q();X(t,e),p.currentMedia=e}function me(e){if(e.tagName==="IMG"){const t=e,s=t.src;if(!t.complete||t.naturalWidth<50||t.naturalHeight<50)return!1;const r=[/\/profile_images\//i,/\/avatar/i,/\/emoji\//i,/\/hashflags\//i,/\/badge/i,/\/icon/i,/_normal\./i,/_bigger\./i,/_mini\./i];for(const n of r)if(n.test(s))return!1;return!0}return e.tagName==="VIDEO"?e.readyState>=1:!1}function de(e){const t=Q(),s=i=>{i.preventDefault(),i.stopPropagation(),p.currentMedia&&(t.style.background="#22c55e",setTimeout(()=>{t.style.background="#6366f1"},200),e(p.currentMedia))};t.addEventListener("click",s);const r=i=>{const o=i.target;me(o)&&(p.hoverTimeout&&(clearTimeout(p.hoverTimeout),p.hoverTimeout=null),p.hoverTimeout=setTimeout(()=>{ge(o)},oe))},n=i=>{const o=i.target;p.currentMedia===o&&ee()},a=()=>{if(p.currentMedia&&!p.isButtonHovered){const i=document.getElementById(B);i&&i.style.display!=="none"&&X(i,p.currentMedia)}};return document.addEventListener("mouseover",r),document.addEventListener("mouseout",n),window.addEventListener("scroll",a,{passive:!0}),()=>{t.removeEventListener("click",s),document.removeEventListener("mouseover",r),document.removeEventListener("mouseout",n),window.removeEventListener("scroll",a),p.hoverTimeout&&clearTimeout(p.hoverTimeout),t.remove()}}function P(e,t){const s="ccc-toast-"+Date.now(),r=document.createElement("div");r.id=s,r.textContent=e;const n={success:"#22c55e",error:"#ef4444",info:"#3b82f6"};r.style.cssText=["position:fixed","bottom:24px","right:24px","max-width:320px","padding:12px 16px","border-radius:8px",'font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif',"font-size:14px","font-weight:500","box-shadow:0 4px 12px rgba(0,0,0,0.25)","z-index:2147483647","pointer-events:none",`background:${n[t]}`,"color:#fff"].join(";");const a=document.createElement("style");a.textContent="@keyframes ccc-toast-in{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}",document.head.appendChild(a),document.body.appendChild(r),r.style.animation="ccc-toast-in 0.2s ease",setTimeout(()=>{r.style.opacity="0",r.style.transition="opacity 0.2s ease",setTimeout(()=>{r.remove(),a.remove()},200)},4e3)}const fe=["misskey.io","misskey.art","misskey.net","misskey.design","misskey.xyz","mi.0px.io","misskey.pizza","misskey.cloud","misskey.st","misskey.id"];function he(e){try{const t=new URL(e).hostname;return fe.some(s=>t===s||t.endsWith("."+s))}catch{return!1}}function Ae(e){const t=e.closest("[data-note-id]");if(t){const a=t.getAttribute("data-note-id");if(a)return a}const s=e.closest("article[data-id]");if(s){const a=s.getAttribute("data-id");if(a)return a}const r=e.closest('a[href*="/notes/"]')||e.querySelector('a[href*="/notes/"]');if(r){const a=r.getAttribute("href");if(a){const i=a.match(/\/notes\/([a-zA-Z0-9]+)/);if(i)return i[1]}}const n=e.closest('article, [class*="note"], [class*="post"]');if(n){const a=n.querySelectorAll('a[href*="/notes/"]');for(const i of a){const o=i.getAttribute("href");if(o){const c=o.match(/\/notes\/([a-zA-Z0-9]+)/);if(c)return c[1]}}}return null}function pe(e){var g,m;const t=e.closest('article, [class*="note"], [class*="post"]');if(!t)return null;const r=t.querySelector('[class*="renote"], [class*="quote"]')||t,n=r.querySelector(`
    [class*="avatar"] + [class*="name"],
    [class*="header"] [class*="name"],
    [class*="user"] [class*="name"],
    header a[href*="/@"]
  `);if(n){const A=((g=n.textContent)==null?void 0:g.trim())||"",b=A.match(/@([a-zA-Z0-9_-]+)@([a-zA-Z0-9.-]+)/);if(b)return{username:b[1],host:b[2]};const x=A.match(/@([a-zA-Z0-9_-]+)/);if(x)return{username:x[1],host:""}}const a=r.querySelector('[class*="header"], header, [class*="top"]');if(a){const A=a.querySelector('a[href*="/@"]');if(A){const x=(A.getAttribute("href")||"").match(/\/@([a-zA-Z0-9_-]+)(?:@([a-zA-Z0-9.-]+))?/);if(x)return{username:x[1],host:x[2]||""}}}const i=r.querySelector('a[href*="/@"]:has(img[class*="avatar"]), a[href*="/@"] img[class*="avatar"]');if(i){const A=i.closest('a[href*="/@"]');if(A){const x=(A.getAttribute("href")||"").match(/\/@([a-zA-Z0-9_-]+)(?:@([a-zA-Z0-9.-]+))?/);if(x)return{username:x[1],host:x[2]||""}}}const o=r.querySelectorAll('a[href*="/@"]');for(const A of o){const b=A.getAttribute("href")||"";if(A.closest('[class*="text"], [class*="content"]'))continue;const T=b.match(/\/@([a-zA-Z0-9_-]+)(?:@([a-zA-Z0-9.-]+))?/);if(T)return{username:T[1],host:T[2]||""}}const c=r.querySelectorAll('[class*="userName"], [class*="username"], [class*="display-name"]');for(const A of c){const b=((m=A.textContent)==null?void 0:m.trim())||"",x=b.match(/@([a-zA-Z0-9_-]+)@([a-zA-Z0-9.-]+)/);if(x)return{username:x[1],host:x[2]};const T=b.match(/@([a-zA-Z0-9_-]+)/);if(T)return{username:T[1],host:""}}return null}function be(e){const t=e.closest('article, [class*="note"], [class*="post"]');if(!t)return["tagme"];const s=t.querySelectorAll('a[href*="/tags/"], a[href*="/tag/"]'),r=[];for(const o of s){const g=(o.getAttribute("href")||"").match(/\/tags?\/([a-zA-Z0-9_]+)/);g&&r.push(g[1].toLowerCase())}const n=t.textContent||"",a=J(n),i=[...new Set([...r,...a])];return i.length>0?i:["tagme"]}const xe={name:"misskey",matches(e){return he(e)},async extract(e,t){const s=window.location.href,r=new URL(s).hostname,n=Ae(e);if(!n)return console.log("[CCC] Misskey: Could not find note ID"),null;const a=`https://${r}/notes/${n}`,i=pe(e);let o=null;i&&(o=i.host?`https://${r}/@${i.username}@${i.host}`:`https://${r}/@${i.username}`);const c=be(e);i!=null&&i.username&&c.unshift(`artist:${i.username.toLowerCase()}`);const g=[];o&&o!==a&&g.push(o);const m=O(e,t);return{url:t,source:a,secondarySources:g.length>0?g:void 0,tags:c,safety:"safe",type:m?"video":"image",filename:N(t),metadata:{noteId:n,instance:r,username:i==null?void 0:i.username,userHost:i==null?void 0:i.host}}},findGrabbableMedia(){const e=[];return document.querySelectorAll(`
      article img,
      [data-note-id] img,
      [class*="note"] img,
      [class*="post"] img
    `).forEach(r=>{this.isGrabbable(r)&&e.push(r)}),document.querySelectorAll(`
      article video,
      [data-note-id] video,
      [class*="note"] video,
      [class*="post"] video
    `).forEach(r=>{e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO"||!e.closest(`
      article,
      [data-note-id],
      [class*="note"],
      [class*="post"]
    `))return!1;if(e.tagName==="IMG"){const s=e;if(!s.complete||s.naturalWidth<50||s.naturalHeight<50)return!1;const r=s.src;if(r.includes("/avatar")||r.includes("/icon"))return!1}return!0}};function ye(e){return/twitter\.com|x\.com/.test(e)}function we(e){const t=e.closest('article, [data-testid="tweet"], [role="article"]');if(t){const n=t.querySelectorAll('a[href*="/status/"]');for(const o of n){const c=o.getAttribute("href");if(c){const g=c.match(/\/status\/(\d+)/);if(g&&!(o.textContent||"").match(/^@\w+$/))return g[1]}}const a=t.getAttribute("data-tweet-id");if(a)return a;const i=t.querySelector("time");if(i){const o=i.closest('a[href*="/status/"]');if(o){const c=o.getAttribute("href");if(c){const g=c.match(/\/status\/(\d+)/);if(g)return g[1]}}}}const r=window.location.href.match(/\/status\/(\d+)/);return r?r[1]:null}function ve(e){const t=e.closest('article, [data-testid="tweet"], [role="article"]');if(!t)return null;if(t.querySelector('[data-testid="socialContext"]')){const a=(t.querySelector('[data-testid="tweet"]')||t).querySelectorAll('a[href^="/"]');for(const i of a){const c=(i.getAttribute("href")||"").match(/^\/([a-zA-Z0-9_]+)(?:\/|$)/);if(c&&!["status","i","home","explore","notifications","messages"].includes(c[1])&&i.closest('[data-testid="User-Name"], [class*="user"]'))return c[1]}}const r=t.querySelectorAll('a[href^="/"]');for(const n of r){const i=(n.getAttribute("href")||"").match(/^\/([a-zA-Z0-9_]+)(?:\/|$)/);if(i&&!["status","i","home","explore","notifications","messages"].includes(i[1])&&n.closest('[data-testid="User-Name"]'))return i[1]}for(const n of r){const i=(n.getAttribute("href")||"").match(/^\/([a-zA-Z0-9_]+)(?:\/|$)/);if(i&&!["status","i","home","explore","notifications","messages"].includes(i[1])&&!n.closest('[data-testid="tweetText"]'))return i[1]}return null}function Se(e){if(!e.includes("twimg.com"))return e;try{const t=new URL(e),s=t.searchParams.get("name");if(!s||["small","medium","large","thumb"].includes(s))return t.searchParams.set("name","orig"),t.toString()}catch{}return e}function Ce(e){var o;const t=e.closest('article, [data-testid="tweet"], [role="article"]');if(!t)return["tagme"];const s=t.querySelectorAll('a[href*="/hashtag/"]'),r=[];for(const c of s){const m=(c.getAttribute("href")||"").match(/\/hashtag\/([a-zA-Z0-9_]+)/);m&&r.push(m[1].toLowerCase())}const n=((o=t.querySelector('[data-testid="tweetText"]'))==null?void 0:o.textContent)||"",a=J(n),i=[...new Set([...r,...a])];return i.length>0?i:["tagme"]}function ke(e,t){return!!(e.tagName==="VIDEO"||t.startsWith("blob:")||t.includes("video.twimg.com")||t.includes(".mp4")||t.includes(".webm")||e.closest('[data-testid="videoPlayer"], [data-testid="previewInterstitial"]'))}const Ee={name:"twitter",matches(e){return ye(e)},async extract(e,t){const s=we(e);if(!s)return console.log("[CCC] Twitter: Could not find tweet ID"),null;const r=ve(e),n=r?`https://x.com/${r}/status/${s}`:`https://x.com/i/status/${s}`,a=ke(e,t);let i=t;!a&&t.includes("twimg.com")&&(i=Se(t));const o=Ce(e);return r&&o.unshift(`artist:${r.toLowerCase()}`),{url:a?n:i,source:n,tags:o,safety:"safe",type:a?"video":"image",filename:N(i),metadata:{tweetId:s,username:r,originalUrl:t,upgradedUrl:i!==t?i:void 0}}},findGrabbableMedia(){const e=[];return document.querySelectorAll(`
      article img,
      [data-testid="tweet"] img,
      [data-testid="tweetPhoto"] img
    `).forEach(r=>{this.isGrabbable(r)&&e.push(r)}),document.querySelectorAll(`
      article video,
      [data-testid="videoPlayer"] video,
      [data-testid="previewInterstitial"] video
    `).forEach(r=>{e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO"||!e.closest(`
      article,
      [data-testid="tweet"],
      [data-testid="tweetPhoto"],
      [data-testid="videoPlayer"],
      [role="article"]
    `))return!1;if(e.tagName==="IMG"){const s=e,r=s.src;if(r.includes("/profile_images/")&&(r.includes("_normal.")||r.includes("_bigger.")||r.includes("_mini.")||r.includes("_200x200."))||r.includes("/emoji/")||r.includes("/hashflags/")||r.includes("/badge")||r.includes("/icon")||!s.complete||s.naturalWidth<50||s.naturalHeight<50)return!1}return!0}};function Te(e){return/danbooru\.donmai\.us|safebooru\.org/.test(e)}function Ie(){var a,i;const e=[];let t="safe";const s=(o,c)=>{document.querySelectorAll(o).forEach(g=>{var A;const m=g.querySelector('a.search-tag, a[href*="/posts?tags="]');if(m){const b=(A=m.textContent)==null?void 0:A.trim().replace(/ /g,"_");b&&b.length>=2&&e.push(`${c}:${v(b)}`)}})};s(".tag-type-artist","artist"),s(".tag-type-copyright","copyright"),s(".tag-type-character","character"),s(".tag-type-meta","meta"),document.querySelectorAll(".tag-type-general").forEach(o=>{var g;const c=o.querySelector('a.search-tag, a[href*="/posts?tags="]');if(c){const m=(g=c.textContent)==null?void 0:g.trim().replace(/ /g,"_");m&&m.length>=2&&e.push(v(m))}});const r=document.querySelector('.tag-type-rating a, [data-tag-category="rating"] a');if(r){const o=((a=r.textContent)==null?void 0:a.toLowerCase())||"";(o.includes("explicit")||o.includes("questionable"))&&(t=o.includes("explicit")?"unsafe":"sketchy")}const n=document.querySelector("#post-information, .post-info");if(n){const o=((i=n.textContent)==null?void 0:i.toLowerCase())||"";o.includes("rating: e")||o.includes("rating:explicit")?t="unsafe":(o.includes("rating: q")||o.includes("rating:questionable"))&&(t="sketchy")}return{tags:e,safety:t}}function Me(){const e=document.querySelector(`
    a[href*="//img"],
    a[href*="/original/"],
    a[href*="cdn.donmai.us"],
    #image-download-link,
    a[download]
  `);if(e){const r=e.getAttribute("href");if(r)return r}const t=document.querySelector("#image, .post-image img, [data-original-url]");if(t){const r=t.getAttribute("src")||t.getAttribute("data-original-url")||t.getAttribute("data-file-url");if(r)return r}const s=document.querySelector("script[data-post-id]");if(s){const n=(s.textContent||"").match(/"file_url"\s*:\s*"([^"]+)"/);if(n)return n[1].replace(/\\\//g,"/")}return null}function qe(){var s;const e=window.location.pathname.match(/\/posts\/(\d+)/);if(e)return e[1];const t=(s=document.querySelector("[data-post-id]"))==null?void 0:s.getAttribute("data-post-id");return t||null}const Le={name:"danbooru",matches(e){return Te(e)},async extract(e,t){const s=window.location.href,r=Me(),n=r||t,{tags:a,safety:i}=Ie(),o=qe(),c=O(e,n);return{url:n,source:s,tags:a.length>0?a:["tagme"],safety:i,type:c?"video":"image",filename:N(n),skipTagging:!0,metadata:{postId:o,originalUrl:r}}},findGrabbableMedia(){const e=[],t=document.querySelector("#image, .post-image img");return t&&e.push(t),document.querySelectorAll(".post-preview img, .post-thumbnail img").forEach(r=>{this.isGrabbable(r)&&e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO")return!1;if(e.id==="image"||e.closest(".post-image"))return!0;if(e.closest(".post-preview, .post-thumbnail")){const t=e;return t.complete&&t.naturalWidth>=50}return!1}};function _e(e){return/gelbooru\.com/.test(e)}function Ne(){var a,i;const e=[];let t="safe";document.querySelectorAll(".tag-type").forEach(o=>{var A;const c=o.className,g=o.querySelector('a[href*="index.php?page=post&s=list&tags="]');if(!g)return;const m=(A=g.textContent)==null?void 0:A.trim().replace(/ /g,"_");!m||m.length<2||(c.includes("tag-type-artist")?e.push(`artist:${v(m)}`):c.includes("tag-type-copyright")?e.push(`copyright:${v(m)}`):c.includes("tag-type-character")?e.push(`character:${v(m)}`):c.includes("tag-type-metadata")?e.push(`meta:${v(m)}`):e.push(v(m)))});const r=document.querySelector('.tag-type-rating a, #stats li:contains("Rating")');if(r){const o=((a=r.textContent)==null?void 0:a.toLowerCase())||"";o.includes("explicit")?t="unsafe":o.includes("questionable")&&(t="sketchy")}const n=document.querySelector("#stats, .post-info");if(n){const o=((i=n.textContent)==null?void 0:i.toLowerCase())||"";o.includes("rating: explicit")||o.includes("rating:explicit")?t="unsafe":(o.includes("rating: questionable")||o.includes("rating:questionable"))&&(t="sketchy")}return{tags:e,safety:t}}function Pe(){const e=document.querySelector(`
    a[href*="//img"],
    a[href*="/images/"],
    #image-link,
    a[download],
    .original-file-notice a
  `);if(e){const r=e.getAttribute("href");if(r&&!r.includes("sample."))return r}const t=document.querySelector("#image, .post-image img, #main-image");if(t){const r=t.getAttribute("src");if(r&&!r.includes("sample."))return r;const n=t.getAttribute("data-original-url")||t.getAttribute("data-file-url");if(n)return n}const s=Array.from(document.querySelectorAll("a")).find(r=>{var n;return(n=r.textContent)==null?void 0:n.toLowerCase().includes("original")});if(s){const r=s.getAttribute("href");if(r)return r}return null}function $e(){var r;const t=new URLSearchParams(window.location.search).get("id");if(t)return t;const s=(r=document.querySelector("[data-id]"))==null?void 0:r.getAttribute("data-id");return s||null}const Ue={name:"gelbooru",matches(e){return _e(e)},async extract(e,t){const s=window.location.href,r=Pe(),n=r||t,{tags:a,safety:i}=Ne(),o=$e(),c=O(e,n);return{url:n,source:s,tags:a.length>0?a:["tagme"],safety:i,type:c?"video":"image",filename:N(n),skipTagging:!0,metadata:{postId:o,originalUrl:r}}},findGrabbableMedia(){const e=[],t=document.querySelector("#image, .post-image img, #main-image");return t&&e.push(t),document.querySelectorAll(".thumb img, .thumbnail img, .post-preview img").forEach(r=>{this.isGrabbable(r)&&e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO")return!1;if(e.id==="image"||e.closest(".post-image"))return!0;if(e.closest(".thumb, .thumbnail, .post-preview")){const t=e;return t.complete&&t.naturalWidth>=50}return!1}};function Oe(e){return/rule34\.xxx/.test(e)}function Ge(){var n;const e=[];let t="unsafe";document.querySelectorAll(".tag-type").forEach(a=>{var g;const i=a.className,o=a.querySelector('a[href*="index.php?page=post&s=list&tags="]');if(!o)return;const c=(g=o.textContent)==null?void 0:g.trim().replace(/ /g,"_");!c||c.length<2||(i.includes("tag-type-artist")?e.push(`artist:${v(c)}`):i.includes("tag-type-copyright")?e.push(`copyright:${v(c)}`):i.includes("tag-type-character")?e.push(`character:${v(c)}`):i.includes("tag-type-metadata")?e.push(`meta:${v(c)}`):e.push(v(c)))});const r=document.querySelector("#stats, .post-info");if(r){const a=((n=r.textContent)==null?void 0:n.toLowerCase())||"";a.includes("rating: safe")?t="safe":(a.includes("rating: questionable")||a.includes("rating:questionable"))&&(t="sketchy")}return{tags:e,safety:t}}function Re(){const e=document.querySelector('a[href*="//img"], a[href*="/images/"], #image-link, a[download], .original-file-notice a');if(e){const r=e.getAttribute("href");if(r&&!r.includes("sample."))return r}const t=document.querySelector("#image, .post-image img, #main-image");if(t){const r=t.getAttribute("src");if(r&&!r.includes("sample."))return r;const n=t.getAttribute("data-original-url")||t.getAttribute("data-file-url");if(n)return n}const s=Array.from(document.querySelectorAll("a")).find(r=>{var n;return(n=r.textContent)==null?void 0:n.toLowerCase().includes("original")});if(s){const r=s.getAttribute("href");if(r)return r}return null}function Be(){var r;const t=new URLSearchParams(window.location.search).get("id");if(t)return t;const s=(r=document.querySelector("[data-id]"))==null?void 0:r.getAttribute("data-id");return s||null}const ze={name:"rule34",matches(e){return Oe(e)},async extract(e,t){const s=window.location.href,r=Re(),n=r||t,{tags:a,safety:i}=Ge(),o=Be(),c=O(e,n);return{url:n,source:s,tags:a.length>0?a:["tagme"],safety:i,type:c?"video":"image",filename:N(n),skipTagging:!0,metadata:{postId:o,originalUrl:r}}},findGrabbableMedia(){const e=[],t=document.querySelector("#image, .post-image img, #main-image");return t&&e.push(t),document.querySelectorAll(".thumb img, .thumbnail img, .post-preview img").forEach(r=>{this.isGrabbable(r)&&e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO")return!1;if(e.id==="image"||e.closest(".post-image"))return!0;if(e.closest(".thumb, .thumbnail, .post-preview")){const t=e;return t.complete&&t.naturalWidth>=50}return!1}};function De(e){return/yande\.re/.test(e)}function Fe(){var a,i;const e=[];let t="safe";const s=(o,c)=>{document.querySelectorAll(o).forEach(g=>{var A;const m=g.querySelector('a[href*="/post?tags="], a[href*="/post/show/"]');if(m){const b=(A=m.textContent)==null?void 0:A.trim().replace(/ /g,"_");b&&b.length>=2&&e.push(`${c}:${v(b)}`)}})};s(".tag-type-artist","artist"),s(".tag-type-copyright","copyright"),s(".tag-type-character","character"),s(".tag-type-circle","circle"),s(".tag-type-faults","faults"),document.querySelectorAll(".tag-type-general, .tag-type-").forEach(o=>{var g;const c=o.querySelector('a[href*="/post?tags="]');if(c){const m=(g=c.textContent)==null?void 0:g.trim().replace(/ /g,"_");m&&m.length>=2&&e.push(v(m))}});const r=document.querySelector(".tag-type-rating a, #stats li");if(r){const o=((a=r.textContent)==null?void 0:a.toLowerCase())||"";o.includes("explicit")||o.includes("rating:e")?t="unsafe":(o.includes("questionable")||o.includes("rating:q"))&&(t="sketchy")}const n=document.querySelector("#stats, .post-info, .sidebar");if(n){const o=((i=n.textContent)==null?void 0:i.toLowerCase())||"";o.includes("rating: e")||o.includes("rating:explicit")?t="unsafe":(o.includes("rating: q")||o.includes("rating:questionable"))&&(t="sketchy")}return{tags:e,safety:t}}function Ve(){const e=document.querySelector(`
    a[href*="//yande.re/image"],
    a[href*="/jpeg/"],
    a[href*="/png/"],
    #highres,
    a[download]
  `);if(e){const r=e.getAttribute("href");if(r)return r}const t=document.querySelector("#image, .post-image img, #main-image");if(t){const r=t.getAttribute("src");if(r&&!r.includes("sample."))return r;const n=t.getAttribute("data-original-url")||t.getAttribute("data-file-url");if(n)return n}const s=Array.from(document.querySelectorAll("a")).find(r=>{var n,a;return((n=r.textContent)==null?void 0:n.toLowerCase().includes("original"))||((a=r.textContent)==null?void 0:a.toLowerCase().includes("highres"))});if(s){const r=s.getAttribute("href");if(r)return r}return null}function je(){var s;const e=window.location.pathname.match(/\/post\/show\/(\d+)/);if(e)return e[1];const t=(s=document.querySelector("[data-id]"))==null?void 0:s.getAttribute("data-id");return t||null}const He=[xe,Ee,Le,Ue,ze,{name:"yande",matches(e){return De(e)},async extract(e,t){const s=window.location.href,r=Ve(),n=r||t,{tags:a,safety:i}=Fe(),o=je(),c=O(e,n);return{url:n,source:s,tags:a.length>0?a:["tagme"],safety:i,type:c?"video":"image",filename:N(n),skipTagging:!0,metadata:{postId:o,originalUrl:r}}},findGrabbableMedia(){const e=[],t=document.querySelector("#image, .post-image img, #main-image");return t&&e.push(t),document.querySelectorAll(".thumb img, .preview img, .post-preview img").forEach(r=>{this.isGrabbable(r)&&e.push(r)}),e},isGrabbable(e){if(e.tagName!=="IMG"&&e.tagName!=="VIDEO")return!1;if(e.id==="image"||e.closest(".post-image"))return!0;if(e.closest(".thumb, .preview, .post-preview")){const t=e;return t.complete&&t.naturalWidth>=50}return!1}}];let $=null;function Ke(){const e=window.location.href;for(const t of He)if(t.matches(e))return t;return null}function We(e){const t=ie(e);if(t)return t;if(e.tagName!=="IMG"&&e.tagName!=="VIDEO"){const r=window.getComputedStyle(e).backgroundImage.match(/url\(['"]?([^'")]+)['"]?\)/);if(r)return r[1]}return null}async function Ze(e){if(!$){P("No extractor available for this page","error");return}const t=We(e);if(!t){P("Could not find media URL","error");return}console.log("[CCC] Extracting media from:",e.tagName,t);try{const s=await $.extract(e,t);if(!s){P("Could not extract media info","error");return}console.log("[CCC] Extracted media info:",s);const r={action:"SUBMIT_JOB",payload:s},n=await _.runtime.sendMessage(r);n&&n.success?P(`Job queued: ${n.jobId}`,"success"):P((n==null?void 0:n.error)||"Failed to submit job","error")}catch(s){console.error("[CCC] Error extracting media:",s),P(s instanceof Error?s.message:"Unknown error","error")}}function Ye(){new MutationObserver(t=>{for(const s of t)if(s.type==="childList"){for(const r of s.addedNodes)if(r instanceof HTMLElement&&(r.querySelectorAll("img, video").length>0||r.tagName==="IMG"||r.tagName==="VIDEO")){console.log("[CCC] New media elements detected");break}}}).observe(document.body,{childList:!0,subtree:!0})}function te(){if(console.log("[CCC] Content script initializing on:",window.location.href),$=Ke(),!$){console.log("[CCC] No extractor found for this page");return}console.log("[CCC] Using extractor:",$.name);const e=de(Ze);Ye();const t=$.findGrabbableMedia();console.log(`[CCC] Found ${t.length} grabbable media elements`),window.addEventListener("beforeunload",()=>{e()})}const Je={matches:["*://*.twitter.com/*","*://*.x.com/*","*://*.misskey.io/*","*://*.misskey.art/*","*://*.misskey.net/*","*://*.misskey.design/*","*://*.misskey.xyz/*","*://*.mi.0px.io/*","*://*.misskey.pizza/*","*://*.misskey.cloud/*","*://danbooru.donmai.us/*","*://safebooru.org/*","*://*.gelbooru.com/*","*://rule34.xxx/*","*://yande.re/*"],runAt:"document_idle",main(){_.runtime.onMessage.addListener((e,t,s)=>e.action==="GET_PAGE_INFO"?(s({url:window.location.href,title:document.title}),!0):!1),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",te):te()}};function z(e,...t){}const Qe={debug:(...e)=>z(console.debug,...e),log:(...e)=>z(console.log,...e),warn:(...e)=>z(console.warn,...e),error:(...e)=>z(console.error,...e)},F=class F extends Event{constructor(t,s){super(F.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=s}};q(F,"EVENT_NAME",j("wxt:locationchange"));let V=F;function j(e){var t;return`${(t=_==null?void 0:_.runtime)==null?void 0:t.id}:content:${e}`}function Xe(e){let t,s;return{run(){t==null&&(s=new URL(location.href),t=e.setInterval(()=>{let r=new URL(location.href);r.href!==s.href&&(window.dispatchEvent(new V(r,s)),s=r)},1e3))}}}const G=class G{constructor(t,s){q(this,"isTopFrame",window.self===window.top);q(this,"abortController");q(this,"locationWatcher",Xe(this));q(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=s,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return _.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,s){const r=setInterval(()=>{this.isValid&&t()},s);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,s){const r=setTimeout(()=>{this.isValid&&t()},s);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const s=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(s)),s}requestIdleCallback(t,s){const r=requestIdleCallback((...n)=>{this.signal.aborted||t(...n)},s);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,s,r,n){var a;s==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(a=t.addEventListener)==null||a.call(t,s.startsWith("wxt:")?j(s):s,r,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Qe.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:G.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var a,i,o;const s=((a=t.data)==null?void 0:a.type)===G.SCRIPT_STARTED_MESSAGE_TYPE,r=((i=t.data)==null?void 0:i.contentScriptName)===this.contentScriptName,n=!this.receivedMessageIds.has((o=t.data)==null?void 0:o.messageId);return s&&r&&n}listenForNewerScripts(t){let s=!0;const r=n=>{if(this.verifyScriptStartedEvent(n)){this.receivedMessageIds.add(n.data.messageId);const a=s;if(s=!1,a&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};q(G,"SCRIPT_STARTED_MESSAGE_TYPE",j("wxt:content-script-started"));let H=G;const et=Symbol("null");let tt=0;class rt extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[s,r]of t)this.set(s,r)}}_getPublicKeys(t,s=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const r=this._getPrivateKey(t,s);let n;return r&&this._publicKeys.has(r)?n=this._publicKeys.get(r):s&&(n=[...t],this._publicKeys.set(r,n)),{privateKey:r,publicKey:n}}_getPrivateKey(t,s=!1){const r=[];for(let n of t){n===null&&(n=et);const a=typeof n=="object"||typeof n=="function"?"_objectHashes":typeof n=="symbol"?"_symbolHashes":!1;if(!a)r.push(n);else if(this[a].has(n))r.push(this[a].get(n));else if(s){const i=`@@mkm-ref-${tt++}@@`;this[a].set(n,i),r.push(i)}else return!1}return JSON.stringify(r)}set(t,s){const{publicKey:r}=this._getPublicKeys(t,!0);return super.set(r,s)}get(t){const{publicKey:s}=this._getPublicKeys(t);return super.get(s)}has(t){const{publicKey:s}=this._getPublicKeys(t);return super.has(s)}delete(t){const{publicKey:s,privateKey:r}=this._getPublicKeys(t);return!!(s&&super.delete(s)&&this._publicKeys.delete(r))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new rt;function mt(){}function D(e,...t){}const st={debug:(...e)=>D(console.debug,...e),log:(...e)=>D(console.log,...e),warn:(...e)=>D(console.warn,...e),error:(...e)=>D(console.error,...e)};return(async()=>{try{const{main:e,...t}=Je,s=new H("content",t);return await e(s)}catch(e){throw st.error('The content script "content" crashed on startup!',e),e}})()})();
content;
