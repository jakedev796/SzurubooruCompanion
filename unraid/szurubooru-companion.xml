<?xml version="1.0"?>
<Container version="2">
  <Name>SzurubooruCompanion</Name>
  <Repository>ghcr.io/jakedev796/szuruboorucompanion:latest</Repository>
  <Registry>https://ghcr.io/jakedev796/szuruboorucompanion</Registry>
  <Network>bridge</Network>
  <Privileged>false</Privileged>
  <Support>https://github.com/jakedev796/SzurubooruCompanion/issues</Support>
  <Project>https://github.com/jakedev796/SzurubooruCompanion</Project>
  <Overview>
    Szurubooru Companion (CCC) - Upload and auto-tag media to Szurubooru or Oxibooru with AI tagging (WD14), gallery-dl, and yt-dlp.
    Includes FastAPI backend, React dashboard, PostgreSQL, and Redis in a single container via s6-overlay.

    Compatible with both Szurubooru (https://github.com/rr-/szurubooru) and Oxibooru (https://github.com/liamw1/oxibooru).

    NEW: Database-backed multi-user system. All configuration done via dashboard UI at http://[IP]:21425/settings.
    Only ADMIN_USER, ADMIN_PASSWORD, and ENCRYPTION_KEY are needed - everything else configured after login!
  </Overview>
  <Category>MediaApp:Other</Category>
  <WebUI>http://[IP]:[PORT:21425]/</WebUI>
  <TemplateURL>https://raw.githubusercontent.com/jakedev796/SzurubooruCompanion/main/unraid/szurubooru-companion.xml</TemplateURL>
  <Icon>https://raw.githubusercontent.com/jakedev796/SzurubooruCompanion/main/misc/styling/reimu.jpg</Icon>
  <ExtraParams/>
  <Description>
    Szurubooru Companion (CCC) - A multi-component workflow for uploading media to Szurubooru or Oxibooru with AI tagging.
    Includes: FastAPI backend, React dashboard, PostgreSQL, Redis (all in one container via s6-overlay).

    After first startup, login at /login with ADMIN_USER/ADMIN_PASSWORD, then configure your Szurubooru/Oxibooru + site credentials in Settings.
  </Description>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- Ports                                                            -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="Web UI Port" Target="21425" Default="21425" Mode="tcp" Description="Web UI and API port" Type="Port" Display="always" Required="true" Mask="false">21425</Config>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- Volumes                                                          -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="App Data" Target="/data" Default="/mnt/user/appdata/szurubooru-companion/data" Mode="rw" Description="Application data (database, jobs, WD14 model cache)" Type="Path" Display="always" Required="true" Mask="false">/mnt/user/appdata/szurubooru-companion/data</Config>
  <Config Name="Config" Target="/config" Default="/mnt/user/appdata/szurubooru-companion/config" Mode="rw" Description="Configuration files (place config.json here for gallery-dl)" Type="Path" Display="always" Required="true" Mask="false">/mnt/user/appdata/szurubooru-companion/config</Config>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- REQUIRED: Admin User and Encryption Key                            -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="Admin Username" Target="ADMIN_USER" Default="admin" Mode="" Description="Admin username (created on first startup, then stored in database)" Type="Variable" Display="always" Required="true" Mask="false">admin</Config>
  <Config Name="Admin Password" Target="ADMIN_PASSWORD" Default="" Mode="" Description="Admin password (REQUIRED - set a strong password)" Type="Variable" Display="always" Required="true" Mask="true"/>
  <Config Name="Encryption Key" Target="ENCRYPTION_KEY" Default="" Mode="" Description="Fernet encryption key for credentials. Generate with: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'" Type="Variable" Display="always" Required="true" Mask="true"/>
  <Config Name="API Key" Target="API_KEY" Default="" Mode="" Description="API key for mobile app and external access (leave empty to disable)" Type="Variable" Display="always" Required="false" Mask="true"/>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- WD14 AI Tagger (ENV-based, requires restart to change)           -->
  <!-- wd14_enabled, confidence threshold, and max tags are live        -->
  <!-- settings in the dashboard (Settings > Global Settings).          -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="WD14 Model" Target="WD14_MODEL" Default="SmilingWolf/wd-swinv2-tagger-v3" Mode="" Description="HuggingFace model name for WD14 tagger (requires restart to change)" Type="Variable" Display="advanced" Required="false" Mask="false">SmilingWolf/wd-swinv2-tagger-v3</Config>
  <Config Name="WD14 Inference Threads" Target="WD14_NUM_WORKERS" Default="4" Mode="" Description="Number of threads for concurrent inference. Used when process pool is off (default) or GPU is active." Type="Variable" Display="advanced" Required="false" Mask="false">4</Config>
  <Config Name="WD14 Use Process Pool" Target="WD14_USE_PROCESS_POOL" Default="false" Mode="" Description="Run inference in a dedicated subprocess (gives PyTorch exclusive access to all CPU cores). Only beneficial when WORKER_CONCURRENCY=1. With multiple workers, leave false so all workers run inference concurrently via the thread pool." Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- Worker Settings                                                  -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="Worker Concurrency" Target="WORKER_CONCURRENCY" Default="1" Mode="" Description="Number of background job workers to spawn (requires restart). Set higher to process multiple jobs in parallel. Disable WD14_USE_PROCESS_POOL when using more than 1 worker." Type="Variable" Display="always" Required="false" Mask="false">1</Config>

  <!-- ══════════════════════════════════════════════════════════════════ -->
  <!-- Server Settings                                                  -->
  <!-- ══════════════════════════════════════════════════════════════════ -->
  <Config Name="Log Level" Target="LOG_LEVEL" Default="INFO" Mode="" Description="Logging level (DEBUG, INFO, WARNING, ERROR)" Type="Variable" Display="advanced" Required="false" Mask="false">INFO</Config>
  <Config Name="Debug Mode" Target="DEBUG" Default="false" Mode="" Description="Enable debug mode (not recommended for production)" Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>
  <Config Name="CORS Origins" Target="CORS_ORIGINS" Default="*" Mode="" Description="Allowed CORS origins (comma-separated, or * for all). Set to your domain if behind a reverse proxy." Type="Variable" Display="advanced" Required="false" Mask="false">*</Config>
</Container>
